<html>
	<head>
		<script type="text/javascript">
			// Create an image object.      
			var image = new Image();
			
			// Can't do anything until the image loads.
			// Hook its onload event before setting the src property.
			image.onload = function() {
			
			   // Create a canvas.
			   var canvas = document.getElementById("stage");
			   
			   // Get the drawing context.
			   var ctx = canvas.getContext('2d');
			   
			   // Get the width/height of the image and set
			   // the canvas to the same size.
			   var width = image.width;
			   var height = image.height;
			   
			   canvas.width = width;
			   canvas.height = height;
			   
			   // Draw the image to the canvas.
			   ctx.drawImage(image, 0, 0);
			   
			   // Get the image data from the canvas, which now
			   // contains the contents of the image.
			   var imageData = ctx.getImageData(0, 0, width, height);
			   
			   // The actual RGBA values are stored in the data property.
			   var pixelData = imageData.data;
			   
			   // 4 bytes per pixels - RGBA
			   var bytesPerPixel = 4;
			   
			   // Loop through every pixel - this could be slow for huge images.
			   for(var y = 0; y < height; y++) {
			      for(var x = 0; x < width; x++) {
				 // Get the index of the first byte of the pixel.
				 var startIdx = (y * bytesPerPixel * width) + (x * bytesPerPixel);
				 
				 // Get the RGB values.
				 var red = pixelData[startIdx];
				 var green = pixelData[startIdx + 1];
				 var blue = pixelData[startIdx + 2];
				 
				 // Convert to grayscale.  An explanation of the ratios
				 // can be found here: http://en.wikipedia.org/wiki/Grayscale
				 var grayScale = (red * 0.3) + (green * 0.59) + (blue * .11);  
				 
				 // Set each RGB value to the same grayscale value.
				 pixelData[startIdx] = grayScale;
				 pixelData[startIdx + 1] = grayScale;
				 pixelData[startIdx + 2] = grayScale;
			      }
			   }
			   
			   // Draw the converted image data back to the canvas.
			   ctx.putImageData(imageData, 0, 0);
			};
			
			// Load an image to convert.
			image.src = "Mona_Lisa.jpg";
		</script>
	</head>
	<body>
		<canvas id="stage"></canvas>
	</body>
	
</html>